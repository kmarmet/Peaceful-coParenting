// Generated by CoffeeScript 2.7.0
var DocumentsManager;

import Manager from "./manager";

import DB from "../database/DB";

import {
  child,
  getDatabase,
  ref,
  set
} from 'firebase/database';

import FirebaseStorage from "../database/firebaseStorage";

import {
  contains,
  formatFileName,
  formatNameFirstNameOnly,
  getFileExtension,
  getFirstWord,
  isAllUppercase,
  removeFileExtension,
  removeSpacesAndLowerCase,
  spaceBetweenWords,
  stringHasNumbers,
  toCamelCase,
  uniqueArray,
  uppercaseFirstLetterOfAllWords,
  wordCount
} from "../globalFunctions";

import DatasetManager from "./datasetManager";

export default DocumentsManager = {
  deleteDocsWithIds: async function(toDelete, currentUser, callback = () => {
      return {};
    }) {
    var docId, docs, i, len, results, thisDoc;
    results = [];
    for (i = 0, len = toDelete.length; i < len; i++) {
      docId = toDelete[i];
      docs = DatasetManager.getValidArray((await DB.getTable(DB.tables.documents)));
      if (Manager.isValid(docs)) {
        results.push((await (async function() {
          var j, len1, results1;
          results1 = [];
          for (j = 0, len1 = docs.length; j < len1; j++) {
            thisDoc = docs[j];
            if (thisDoc.id === docId) {
              await DB.delete(DB.tables.documents, docId);
              await FirebaseStorage.delete(FirebaseStorage.directories.documents, currentUser.id, thisDoc.name);
              if (callback) {
                results1.push(callback(docId));
              } else {
                results1.push(void 0);
              }
            } else {
              results1.push(void 0);
            }
          }
          return results1;
        })()));
      } else {
        results.push(void 0);
      }
    }
    return results;
  },
  addDocumentToDocumentsTable: async function(data) {
    var dbRef, tableData;
    dbRef = ref(getDatabase());
    tableData = (await DB.getTable(DB.tables.documents));
    tableData = Manager.convertToArray(tableData);
    if (Manager.isValid(tableData)) {
      if (tableData.length > 0) {
        tableData = [...tableData, data].filter(function(item) {
          return item;
        });
      } else {
        tableData = [data];
      }
    } else {
      tableData = [data];
    }
    return (await set(child(dbRef, DB.tables.documents), tableData));
  }
};

//# sourceMappingURL=documentsManager.js.map
