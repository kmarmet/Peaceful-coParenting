// Generated by CoffeeScript 2.7.0
var DocumentsManager;

import Manager from "./manager";

import DB from "../database/DB";

import {
  child,
  getDatabase,
  ref,
  set
} from 'firebase/database';

import FirebaseStorage from "../database/firebaseStorage";

import DatasetManager from "./datasetManager";

export default DocumentsManager = {
  deleteDocsWithIds: async function(idsToDelete, currentUser, callback = () => {
      return {};
    }) {
    var docId, docs, i, len, results, thisDoc;
    results = [];
    for (i = 0, len = idsToDelete.length; i < len; i++) {
      docId = idsToDelete[i];
      docs = DatasetManager.getValidArray((await DB.getTable(`${DB.tables.documents}/${currentUser != null ? currentUser.phone : void 0}`)));
      if (Manager.isValid(docs)) {
        results.push((await (async function() {
          var j, len1, results1;
          results1 = [];
          for (j = 0, len1 = docs.length; j < len1; j++) {
            thisDoc = docs[j];
            if (thisDoc.id === docId) {
              await DB.deleteById(`${DB.tables.documents}/${currentUser != null ? currentUser.phone : void 0}`, docId);
              await FirebaseStorage.deleteFile(`${FirebaseStorage.directories.documents}/${currentUser.id}/${thisDoc.name}`);
              if (callback) {
                results1.push(callback(docId));
              } else {
                results1.push(void 0);
              }
            } else {
              results1.push(void 0);
            }
          }
          return results1;
        })()));
      } else {
        results.push(void 0);
      }
    }
    return results;
  },
  addToDocumentsTable: async function(currentUser, data) {
    var dbRef, tableData;
    dbRef = ref(getDatabase());
    tableData = (await DB.getTable(`${DB.tables.documents}/${currentUser != null ? currentUser.phone : void 0}`));
    if (Manager.isValid(tableData)) {
      if (tableData.length > 0) {
        tableData = [...tableData, data].filter(function(item) {
          return item;
        });
      } else {
        tableData = [data];
      }
    } else {
      tableData = [data];
    }
    return (await set(child(dbRef, `${DB.tables.documents}/${currentUser.phone}`), tableData));
  },
  fixTypos: function(jackedUpText) {
    //      .replaceAll "\n", "X"
    //      .replaceAll " 5 ", ""
    return jackedUpText.replaceAll("Xriday", "Friday").replaceAll("Asagreed", "As agreed").replaceAll("Barent", "Parent").replaceAll("Xf", "If").replaceAll("Furst", "First").replaceAll(":\n", "").replaceAll(":", " ").replaceAll("u »", "up").replaceAll("+». lransporling", "transporting").replaceAll("trans Horting", "transporting").replaceAll("th ++", "the").replaceAll("b ,", "by").replaceAll("witha", "with a").replaceAll("ane\n", "anyone").replaceAll("|", "").replaceAll("| -", "").replaceAll("|\n-", "").replaceAll("|\n", "").replaceAll("Racha .-.", "").replaceAll("Racha", "").replaceAll("théir", "their").replaceAll("their-own", "their own").replaceAll(".-.", ".").replaceAll("Transprtatin", "Transportation").replaceAll("(Hyeniyedts)", "").replaceAll("weelend", "weekend").replaceAll(" e ", "").replaceAll("6G", "6.").replaceAll("andi", "and").replaceAll("th\n", "the").replaceAll("++", "").replaceAll("withelegal", "with legal").replaceAll("oo o i a", "").replaceAll("o\n", "").replaceAll("\no", "").replaceAll("\ne", "").replaceAll(": : ", "").replaceAll("PriorityIn", "Priority In").replaceAll("thfollowing", "the following").replaceAll(":o", "").replaceAll(": o", "").replaceAll("at:the", "at the").replaceAll("44 ; pild(ren)’s", "child(ren)'s").replaceAll("birt c 4 Ad Pater y d(ren)’s", "").replaceAll("even-\nbered", "even-numbered").replaceAll("Lar ent 2", "Parent 2").replaceAll("otherwi di pum gE 5 Vols. nless", "").replaceAll("Schoo *", "School").replaceAll("birt IIE", "").replaceAll("tparticipate", "to participate").replaceAll("orSunday", "or Sunday").replaceAll("Jiven", "Given").replaceAll("Bven", "Even").replaceAll("gE ", "").replaceAll("Vols. ", "").replaceAll("chil oa 2y.13 £0 DY SPOIL", "").replaceAll("Wot mt week", "").replaceAll("birt ", "").replaceAll("Pater ", "").replaceAll("Birthda ", "").replaceAll(" d(ren)’s", "child(ren)'s").replaceAll("c 4", "").replaceAll("pild(ren)’s", "children's").replaceAll("ychild(ren)'s", "children's").replaceAll("44 ;", "").replaceAll(" c ", "").replaceAll("even-\n\nbered", "even-numbered").replaceAll(" di ", "").replaceAll("5unless", "unless").replaceAll("otherwi ", "otherwise").replaceAll("otherwisedi", "otherwise").replaceAll("pum", "").replaceAll("4 Ad", "").replaceAll("child(ren)’s   children's", "children's").replaceAll("patent", "parent").replaceAll("IIE", "on his/her").replaceAll(" 1n", " in").replaceAll("\nild(ren)", " children").replaceAll("otherwise\n", "").replaceAll(" nless", "").replaceAll("otherwise\n otherwise", "").replaceAll("entitled\nto", "entitled to").replaceAll(" , ", ", ").replaceAll("10 2.10.   H n. i   ", "10a.m. to 8p.m. for ").replaceAll(" i 3 i her birthday", " ").replaceAll("pam...", "p.m.").replaceAll("Fr\nFinding", "Ending").replaceAll("Le ven a", "").replaceAll("io a 4", "").replaceAll("- pe\n", "").replaceAll("6 00 ", "6:00").replaceAll("Given years", "Even years").replaceAll("5 otherwise", " otherwise").replaceAll(" © ", " ");
  }
};
